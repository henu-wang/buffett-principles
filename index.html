<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warren Buffett Investment Principles Explorer | KeepRule</title>
    <meta name="description" content="Explore 20 key Warren Buffett investment principles with detailed explanations, real-world examples, application tips, and an interactive quiz. Master the Oracle of Omaha's wisdom with KeepRule.">
    <meta name="keywords" content="Warren Buffett, investment principles, value investing, Berkshire Hathaway, investing wisdom, stock market, KeepRule, margin of safety, intrinsic value, economic moat">
    <meta name="author" content="KeepRule">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://henu-wang.github.io/buffett-principles/">

    <!-- Open Graph -->
    <meta property="og:title" content="Warren Buffett Investment Principles Explorer | 20 Key Investing Rules">
    <meta property="og:description" content="Explore 20 key Warren Buffett investment principles with detailed explanations, real-world examples, and interactive quiz mode. Learn from the Oracle of Omaha.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://henu-wang.github.io/buffett-principles/">
    <meta property="og:site_name" content="KeepRule - Buffett Principles Explorer">
    <meta property="og:locale" content="en_US">
    <meta property="og:image" content="https://henu-wang.github.io/buffett-principles/og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Warren Buffett Investment Principles Explorer">
    <meta name="twitter:description" content="Master the Oracle of Omaha's investment wisdom with 20 interactive principles, real-world examples, and quiz mode.">
    <meta name="twitter:image" content="https://henu-wang.github.io/buffett-principles/og-image.png">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Warren Buffett Investment Principles Explorer",
        "description": "Interactive explorer for 20 key Warren Buffett investment principles with quiz mode",
        "url": "https://henu-wang.github.io/buffett-principles/",
        "applicationCategory": "FinanceApplication",
        "author": {
            "@type": "Organization",
            "name": "KeepRule",
            "url": "https://keeprule.com"
        }
    }
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: {50:'#fefce8',100:'#fef9c3',200:'#fef08a',300:'#fde047',400:'#facc15',500:'#eab308',600:'#ca8a04',700:'#a16207',800:'#854d0e',900:'#713f12'},
                        dark: {700:'#0d1117',800:'#0a0e14',900:'#070a0f'}
                    },
                    fontFamily: {
                        display: ['Playfair Display', 'serif'],
                        body: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;0,800;1,400;1,600&family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #070a0f; color: #e2e8f0; }
        h1,h2,h3,.font-display { font-family: 'Playfair Display', serif; }

        /* Animations */
        .card-enter { animation: cardEnter 0.6s cubic-bezier(0.22,1,0.36,1) both; }
        @keyframes cardEnter { from { opacity:0; transform:translateY(30px) scale(0.97); } to { opacity:1; transform:translateY(0) scale(1); } }
        .card-hover { transition: all 0.4s cubic-bezier(0.4,0,0.2,1); }
        .card-hover:hover { transform: translateY(-8px) scale(1.01); box-shadow: 0 25px 50px rgba(234,179,8,0.12), 0 0 0 1px rgba(234,179,8,0.1); }
        .gold-glow { text-shadow: 0 0 40px rgba(234,179,8,0.3); }
        .gold-border { border: 1px solid rgba(234,179,8,0.15); }
        .gold-border:hover { border-color: rgba(234,179,8,0.4); }

        /* Quiz styles */
        .quiz-option { transition: all 0.3s; cursor: pointer; }
        .quiz-option:hover { background: rgba(234,179,8,0.12); border-color: rgba(234,179,8,0.5); }
        .quiz-correct { background: rgba(34,197,94,0.15) !important; border-color: #22c55e !important; }
        .quiz-wrong { background: rgba(239,68,68,0.15) !important; border-color: #ef4444 !important; }

        /* Gradient text */
        .gradient-gold { background: linear-gradient(135deg, #fde047, #eab308, #ca8a04); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0e14; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #334155; }

        /* Pulse animation for category badges */
        .cat-badge { transition: all 0.3s; }
        .cat-badge.active { box-shadow: 0 0 0 2px rgba(234,179,8,0.4); }

        /* Hero pattern overlay */
        .hero-pattern {
            background-image: radial-gradient(circle at 20% 50%, rgba(234,179,8,0.06) 0%, transparent 50%),
                              radial-gradient(circle at 80% 20%, rgba(234,179,8,0.04) 0%, transparent 50%),
                              radial-gradient(circle at 50% 80%, rgba(234,179,8,0.03) 0%, transparent 50%);
        }

        /* Modal */
        .modal-backdrop { background: rgba(0,0,0,0.75); backdrop-filter: blur(8px); }
        .modal-content { animation: modalIn 0.3s ease-out; }
        @keyframes modalIn { from { opacity:0; transform:scale(0.95) translateY(10px); } to { opacity:1; transform:scale(1) translateY(0); } }

        /* Floating nav */
        .nav-scrolled { background: rgba(7,10,15,0.95); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(234,179,8,0.1); }

        /* Stagger children */
        .stagger > *:nth-child(1) { animation-delay: 0.05s; }
        .stagger > *:nth-child(2) { animation-delay: 0.1s; }
        .stagger > *:nth-child(3) { animation-delay: 0.15s; }
        .stagger > *:nth-child(4) { animation-delay: 0.2s; }
        .stagger > *:nth-child(5) { animation-delay: 0.25s; }
        .stagger > *:nth-child(6) { animation-delay: 0.3s; }
        .stagger > *:nth-child(7) { animation-delay: 0.35s; }
        .stagger > *:nth-child(8) { animation-delay: 0.4s; }

        /* Quote marks */
        .quote-mark { font-family: Georgia, serif; font-size: 4rem; line-height: 1; color: rgba(234,179,8,0.3); }

        /* Progress bar */
        .progress-fill { transition: width 0.5s ease; }

        /* Expand/collapse */
        .expandable { max-height: 0; overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s ease; opacity: 0; }
        .expandable.open { max-height: 800px; opacity: 1; }

        /* Tab underline */
        .tab-active { border-bottom: 2px solid #eab308; color: #eab308; }
    </style>
</head>
<body class="min-h-screen">

<!-- Navigation -->
<nav id="navbar" class="fixed top-0 w-full z-50 transition-all duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <a href="https://keeprule.com" class="flex items-center gap-2 group" target="_blank" rel="noopener">
                <span class="text-gold-400 text-2xl font-bold font-display">KR</span>
                <span class="text-gray-400 text-sm hidden sm:block group-hover:text-gold-400 transition-colors">KeepRule</span>
            </a>
            <div class="hidden md:flex items-center gap-6 text-sm">
                <a href="https://keeprule.com/en/principles" class="text-gray-400 hover:text-gold-400 transition-colors" target="_blank" rel="noopener">Principles</a>
                <a href="https://keeprule.com/en/masters" class="text-gray-400 hover:text-gold-400 transition-colors" target="_blank" rel="noopener">Masters</a>
                <a href="https://keeprule.com/en/scenarios" class="text-gray-400 hover:text-gold-400 transition-colors" target="_blank" rel="noopener">Scenarios</a>
                <a href="https://keeprule.com/en/blog" class="text-gray-400 hover:text-gold-400 transition-colors" target="_blank" rel="noopener">Blog</a>
                <button onclick="startQuiz()" class="bg-gold-600 hover:bg-gold-500 text-dark-900 font-semibold px-4 py-2 rounded-lg transition-colors text-sm">Quiz Mode</button>
            </div>
            <button onclick="toggleMobileMenu()" class="md:hidden text-gray-400 hover:text-gold-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
            </button>
        </div>
    </div>
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="hidden md:hidden bg-dark-800 border-t border-gray-800">
        <div class="px-4 py-3 space-y-2">
            <a href="https://keeprule.com/en/principles" class="block py-2 text-gray-400 hover:text-gold-400" target="_blank" rel="noopener">Principles</a>
            <a href="https://keeprule.com/en/masters" class="block py-2 text-gray-400 hover:text-gold-400" target="_blank" rel="noopener">Masters</a>
            <a href="https://keeprule.com/en/scenarios" class="block py-2 text-gray-400 hover:text-gold-400" target="_blank" rel="noopener">Scenarios</a>
            <a href="https://keeprule.com/en/blog" class="block py-2 text-gray-400 hover:text-gold-400" target="_blank" rel="noopener">Blog</a>
            <button onclick="startQuiz(); toggleMobileMenu();" class="w-full bg-gold-600 hover:bg-gold-500 text-dark-900 font-semibold px-4 py-2 rounded-lg mt-2">Quiz Mode</button>
        </div>
    </div>
</nav>

<!-- Hero Section -->
<header class="hero-pattern pt-24 pb-16 sm:pt-32 sm:pb-24 px-4">
    <div class="max-w-4xl mx-auto text-center">
        <p class="text-gold-500 uppercase tracking-[0.3em] text-xs sm:text-sm mb-4 font-medium">The Oracle of Omaha</p>
        <h1 class="text-4xl sm:text-5xl lg:text-7xl font-display font-bold gradient-gold gold-glow mb-6 leading-tight">
            Buffett's Investment<br>Principles
        </h1>
        <p class="text-gray-400 text-base sm:text-lg max-w-2xl mx-auto mb-8 leading-relaxed">
            Twenty timeless principles from the world's greatest investor. Explore, learn, and test your knowledge of the wisdom that built Berkshire Hathaway.
        </p>
        <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <a href="#principles" class="bg-gold-600 hover:bg-gold-500 text-dark-900 font-semibold px-8 py-3 rounded-lg transition-all hover:shadow-lg hover:shadow-gold-600/20">
                Explore Principles
            </a>
            <button onclick="startQuiz()" class="border border-gold-700 text-gold-400 hover:bg-gold-900/30 font-semibold px-8 py-3 rounded-lg transition-all">
                Take the Quiz
            </button>
        </div>
        <!-- Stats -->
        <div class="grid grid-cols-3 gap-4 max-w-lg mx-auto mt-12">
            <div class="text-center">
                <div class="text-2xl sm:text-3xl font-display font-bold text-gold-400">20</div>
                <div class="text-xs text-gray-500 mt-1">Principles</div>
            </div>
            <div class="text-center">
                <div class="text-2xl sm:text-3xl font-display font-bold text-gold-400">5</div>
                <div class="text-xs text-gray-500 mt-1">Categories</div>
            </div>
            <div class="text-center">
                <div class="text-2xl sm:text-3xl font-display font-bold text-gold-400">60+</div>
                <div class="text-xs text-gray-500 mt-1">Years of Wisdom</div>
            </div>
        </div>
    </div>
</header>

<!-- Filter & Search Section -->
<section id="principles" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-8">
    <!-- Search -->
    <div class="relative max-w-xl mx-auto mb-8">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
        <input id="searchInput" type="text" placeholder="Search principles, quotes, or topics..." class="w-full bg-dark-800 border border-gray-700 rounded-xl pl-12 pr-4 py-3 text-gray-200 placeholder-gray-500 focus:outline-none focus:border-gold-600 focus:ring-1 focus:ring-gold-600/50 transition-all" oninput="filterPrinciples()">
    </div>
    <!-- Category Filters -->
    <div class="flex flex-wrap gap-2 justify-center mb-4">
        <button onclick="setCategory('all')" class="cat-badge active px-4 py-2 rounded-full text-sm font-medium bg-dark-800 border border-gray-700 text-gray-300 hover:border-gold-600 hover:text-gold-400 transition-all" data-cat="all">
            All Principles
        </button>
        <button onclick="setCategory('value')" class="cat-badge px-4 py-2 rounded-full text-sm font-medium bg-dark-800 border border-gray-700 text-gray-300 hover:border-gold-600 hover:text-gold-400 transition-all" data-cat="value">
            <span class="inline-block w-2 h-2 rounded-full bg-emerald-400 mr-1.5"></span>Value Investing
        </button>
        <button onclick="setCategory('risk')" class="cat-badge px-4 py-2 rounded-full text-sm font-medium bg-dark-800 border border-gray-700 text-gray-300 hover:border-gold-600 hover:text-gold-400 transition-all" data-cat="risk">
            <span class="inline-block w-2 h-2 rounded-full bg-red-400 mr-1.5"></span>Risk Management
        </button>
        <button onclick="setCategory('quality')" class="cat-badge px-4 py-2 rounded-full text-sm font-medium bg-dark-800 border border-gray-700 text-gray-300 hover:border-gold-600 hover:text-gold-400 transition-all" data-cat="quality">
            <span class="inline-block w-2 h-2 rounded-full bg-blue-400 mr-1.5"></span>Business Quality
        </button>
        <button onclick="setCategory('psychology')" class="cat-badge px-4 py-2 rounded-full text-sm font-medium bg-dark-800 border border-gray-700 text-gray-300 hover:border-gold-600 hover:text-gold-400 transition-all" data-cat="psychology">
            <span class="inline-block w-2 h-2 rounded-full bg-purple-400 mr-1.5"></span>Market Psychology
        </button>
        <button onclick="setCategory('growth')" class="cat-badge px-4 py-2 rounded-full text-sm font-medium bg-dark-800 border border-gray-700 text-gray-300 hover:border-gold-600 hover:text-gold-400 transition-all" data-cat="growth">
            <span class="inline-block w-2 h-2 rounded-full bg-amber-400 mr-1.5"></span>Personal Growth
        </button>
    </div>
    <div id="resultCount" class="text-center text-gray-500 text-sm mb-6">Showing all 20 principles</div>
</section>

<!-- Principles Grid -->
<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <div id="principlesGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6 stagger">
        <!-- Cards rendered by JS -->
    </div>
    <div id="noResults" class="hidden text-center py-16">
        <p class="text-gray-500 text-lg">No principles match your search.</p>
        <button onclick="clearSearch()" class="mt-4 text-gold-400 hover:text-gold-300 underline">Clear search</button>
    </div>
</section>

<!-- CTA Section -->
<section class="border-t border-gray-800 bg-gradient-to-b from-dark-900 to-dark-700">
    <div class="max-w-4xl mx-auto px-4 py-16 sm:py-24 text-center">
        <h2 class="text-3xl sm:text-4xl font-display font-bold gradient-gold mb-4">Go Deeper with KeepRule</h2>
        <p class="text-gray-400 mb-8 max-w-xl mx-auto">Explore investment wisdom from Buffett, Munger, Graham, and more. Apply timeless principles to real-world scenarios.</p>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 max-w-2xl mx-auto">
            <a href="https://keeprule.com/en/principles" target="_blank" rel="noopener" class="gold-border rounded-xl p-4 hover:bg-gold-900/10 transition-all group">
                <div class="text-2xl mb-2">üìú</div>
                <div class="text-sm font-medium text-gray-300 group-hover:text-gold-400 transition-colors">Principles</div>
            </a>
            <a href="https://keeprule.com/en/masters" target="_blank" rel="noopener" class="gold-border rounded-xl p-4 hover:bg-gold-900/10 transition-all group">
                <div class="text-2xl mb-2">üéì</div>
                <div class="text-sm font-medium text-gray-300 group-hover:text-gold-400 transition-colors">Masters</div>
            </a>
            <a href="https://keeprule.com/en/scenarios" target="_blank" rel="noopener" class="gold-border rounded-xl p-4 hover:bg-gold-900/10 transition-all group">
                <div class="text-2xl mb-2">üéØ</div>
                <div class="text-sm font-medium text-gray-300 group-hover:text-gold-400 transition-colors">Scenarios</div>
            </a>
            <a href="https://keeprule.com/en/blog" target="_blank" rel="noopener" class="gold-border rounded-xl p-4 hover:bg-gold-900/10 transition-all group">
                <div class="text-2xl mb-2">üìù</div>
                <div class="text-sm font-medium text-gray-300 group-hover:text-gold-400 transition-colors">Blog</div>
            </a>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="border-t border-gray-800 py-8 px-4">
    <div class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-2">
            <span class="text-gold-500 font-display font-bold text-lg">KeepRule</span>
            <span class="text-gray-600 text-sm">| Investment Wisdom Platform</span>
        </div>
        <div class="flex gap-6 text-sm text-gray-500">
            <a href="https://keeprule.com/en/principles" target="_blank" rel="noopener" class="hover:text-gold-400 transition-colors">Principles</a>
            <a href="https://keeprule.com/en/masters" target="_blank" rel="noopener" class="hover:text-gold-400 transition-colors">Masters</a>
            <a href="https://keeprule.com/en/scenarios" target="_blank" rel="noopener" class="hover:text-gold-400 transition-colors">Scenarios</a>
            <a href="https://keeprule.com/en/blog" target="_blank" rel="noopener" class="hover:text-gold-400 transition-colors">Blog</a>
        </div>
        <p class="text-gray-600 text-xs">&copy; 2025 <a href="https://keeprule.com" class="hover:text-gold-400 transition-colors" target="_blank" rel="noopener">KeepRule.com</a>. All rights reserved.</p>
    </div>
</footer>

<!-- Quiz Modal -->
<div id="quizModal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
    <div class="modal-backdrop absolute inset-0" onclick="closeQuiz()"></div>
    <div class="modal-content relative bg-dark-800 border border-gray-700 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6 sm:p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-display font-bold text-gold-400">Buffett Principles Quiz</h2>
                <button onclick="closeQuiz()" class="text-gray-500 hover:text-gray-300 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <!-- Progress -->
            <div class="mb-6">
                <div class="flex justify-between text-sm text-gray-400 mb-2">
                    <span id="quizProgress">Question 1 of 10</span>
                    <span id="quizScore">Score: 0</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2">
                    <div id="quizProgressBar" class="progress-fill bg-gold-500 h-2 rounded-full" style="width:10%"></div>
                </div>
            </div>
            <!-- Question -->
            <div id="quizContent">
                <p id="quizQuestion" class="text-lg text-gray-200 mb-6 leading-relaxed"></p>
                <div id="quizOptions" class="space-y-3"></div>
            </div>
            <!-- Result -->
            <div id="quizResult" class="hidden text-center py-8">
                <div id="quizEmoji" class="text-6xl mb-4"></div>
                <h3 id="quizResultTitle" class="text-2xl font-display font-bold text-gold-400 mb-2"></h3>
                <p id="quizResultText" class="text-gray-400 mb-6"></p>
                <div class="flex gap-3 justify-center">
                    <button onclick="startQuiz()" class="bg-gold-600 hover:bg-gold-500 text-dark-900 font-semibold px-6 py-2.5 rounded-lg transition-colors">Try Again</button>
                    <a href="https://keeprule.com/en/principles" target="_blank" rel="noopener" class="border border-gold-700 text-gold-400 hover:bg-gold-900/30 font-semibold px-6 py-2.5 rounded-lg transition-all">Explore on KeepRule</a>
                </div>
            </div>
            <!-- Next button -->
            <button id="quizNext" class="hidden mt-6 w-full bg-gold-600 hover:bg-gold-500 text-dark-900 font-semibold py-3 rounded-lg transition-colors" onclick="nextQuestion()">Next Question</button>
        </div>
    </div>
</div>

<!-- Principle Detail Modal -->
<div id="detailModal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
    <div class="modal-backdrop absolute inset-0" onclick="closeDetail()"></div>
    <div class="modal-content relative bg-dark-800 border border-gray-700 rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
        <div class="p-6 sm:p-8" id="detailContent"></div>
    </div>
</div>

<script>
// ========== DATA ==========
const principles = [
    {
        id: 1, category: "value", catLabel: "Value Investing", catColor: "emerald",
        title: "Circle of Competence",
        quote: "Know your circle of competence, and stick within it. The size of that circle is not very important; knowing its boundaries, however, is vital.",
        explanation: "Buffett insists on only investing in businesses he thoroughly understands. This discipline prevents costly mistakes from venturing into unfamiliar territory. The key is not to expand the circle but to recognize its edges.",
        example: "Buffett famously avoided tech stocks during the dot-com bubble because they were outside his circle. While others lost fortunes when the bubble burst in 2000, Berkshire preserved its capital and was ready to buy when opportunities arose.",
        tips: ["List industries you truly understand from work or personal experience", "If you cannot explain a company's business model in two sentences, skip it", "Expand your circle slowly through deep study, not superficial reading", "Say 'I don't know' more often -- it is an investor's best defense"]
    },
    {
        id: 2, category: "risk", catLabel: "Risk Management", catColor: "red",
        title: "Rule #1: Never Lose Money",
        quote: "Rule No. 1: Never lose money. Rule No. 2: Never forget Rule No. 1.",
        explanation: "This is not about avoiding all losses, but about prioritizing capital preservation over chasing gains. The mathematics of loss are brutal: a 50% loss requires a 100% gain just to break even. Buffett's focus on downside protection is the foundation of his wealth.",
        example: "During the 2008 financial crisis, while most investors panicked, Buffett negotiated incredibly favorable deals with Goldman Sachs and GE -- getting preferred shares with 10% dividends and warrants, ensuring his downside was protected even if things got worse.",
        tips: ["Always ask 'What can go wrong?' before asking 'How much can I make?'", "Demand a margin of safety on every investment", "Size positions so no single loss can seriously damage your portfolio", "Remember: avoiding big losses matters more than finding big winners"]
    },
    {
        id: 3, category: "value", catLabel: "Value Investing", catColor: "emerald",
        title: "Intrinsic Value",
        quote: "Price is what you pay. Value is what you get.",
        explanation: "Intrinsic value is the discounted present value of all future cash flows a business will generate. Buffett separates price (market quotation) from value (economic reality). The market often misprices assets, creating opportunities for disciplined investors.",
        example: "In 1988, Buffett began buying Coca-Cola shares at about 15x earnings when the market considered it 'expensive.' He saw intrinsic value in the brand's global cash-generating power. That $1.3 billion investment is now worth over $25 billion, plus billions in dividends.",
        tips: ["Estimate future cash flows conservatively, then discount them back", "Ignore daily price movements -- focus on business value trajectory", "A great business at a fair price beats a fair business at a great price", "Track your intrinsic value estimates annually and refine your models"]
    },
    {
        id: 4, category: "value", catLabel: "Value Investing", catColor: "emerald",
        title: "Margin of Safety",
        quote: "We insist on a margin of safety in our purchase price. If we calculate the value of a common stock to be only slightly higher than its price, we're not interested in buying.",
        explanation: "Borrowed from his mentor Benjamin Graham, the margin of safety is the gap between price and intrinsic value. This buffer protects against errors in analysis, bad luck, and unforeseen events. It is the bridge between theory and reality.",
        example: "When Buffett bought GEICO, he ensured a wide margin of safety. Even if his most pessimistic assumptions proved true, he would still earn a reasonable return. This discipline meant he sometimes waited years for the right price, but rarely lost significantly.",
        tips: ["Aim for at least a 25-30% discount to your estimated intrinsic value", "The less certain you are of the value, the wider the margin you need", "In practice, this means being patient and saying 'no' far more than 'yes'", "A margin of safety is not about precision -- it is about having a buffer for being wrong"]
    },
    {
        id: 5, category: "value", catLabel: "Value Investing", catColor: "emerald",
        title: "Long-Term Holding",
        quote: "Our favorite holding period is forever.",
        explanation: "Buffett treats stocks as ownership stakes in real businesses, not trading tickets. Long-term holding lets compounding work its magic, minimizes transaction costs and taxes, and aligns the investor with the actual performance of the business rather than market noise.",
        example: "Buffett first bought American Express shares in 1964 during the 'salad oil scandal' when the stock cratered. He held through decades of growth. Similarly, his Washington Post investment in 1973, bought for $10 million, grew to over $1 billion over 40 years.",
        tips: ["Only buy companies you would be comfortable holding if the stock market closed for 10 years", "Let compounding do the heavy lifting -- time in the market beats timing the market", "Trading costs and taxes erode returns more than most investors realize", "If the business fundamentals have not changed, do not sell because the price dropped"]
    },
    {
        id: 6, category: "risk", catLabel: "Risk Management", catColor: "red",
        title: "Be Fearful When Others Are Greedy",
        quote: "Be fearful when others are greedy, and greedy when others are fearful.",
        explanation: "Buffett's most famous contrarian principle. Market extremes are driven by emotion, not fundamentals. When euphoria drives prices to absurd highs, risk is greatest. When panic creates fire-sale prices, opportunity is greatest. Acting opposite to the crowd requires immense discipline.",
        example: "In October 2008, amid a market meltdown, Buffett wrote a now-famous NYT op-ed: 'Buy American. I Am.' He invested billions while others sold in terror. Within a few years, those purchases generated extraordinary returns as markets recovered.",
        tips: ["Monitor market sentiment indicators like the VIX, put/call ratios, and fund flows", "Keep a cash reserve so you can act when fear creates bargains", "Develop a watchlist of great companies with pre-determined buy prices", "When magazine covers declare 'The Death of Equities,' start buying"]
    },
    {
        id: 7, category: "quality", catLabel: "Business Quality", catColor: "blue",
        title: "Economic Moats",
        quote: "In business, I look for economic castles protected by unbreachable moats.",
        explanation: "A moat is a durable competitive advantage that protects a business from competitors. Moats can come from brand power, network effects, switching costs, cost advantages, or regulatory barriers. The wider the moat, the more predictable the long-term earnings.",
        example: "See's Candies, bought by Buffett in 1972 for $25 million, had an incredible brand moat. Customers paid premium prices out of loyalty. The company has generated over $2 billion in pre-tax earnings since acquisition, requiring minimal reinvestment.",
        tips: ["Identify what stops competitors from stealing a company's customers", "Moats should be widening over time, not narrowing", "Brand moats are only real if they translate to pricing power", "Network effects (like Visa/Mastercard) create the strongest moats"]
    },
    {
        id: 8, category: "quality", catLabel: "Business Quality", catColor: "blue",
        title: "Owner-Oriented Management",
        quote: "We look for people who are intelligent, energetic, and honest. If they don't have the last quality, the first two will kill you.",
        explanation: "Buffett obsesses over management quality because even the best business can be destroyed by dishonest or incompetent leadership. He seeks managers who think like owners, allocate capital wisely, communicate honestly, and resist empire-building.",
        example: "Buffett praises managers like Ajit Jain (Berkshire's insurance operations) who have created billions in value through disciplined underwriting. Conversely, he has noted how manager self-interest at companies like Salomon Brothers nearly caused catastrophic failure.",
        tips: ["Read proxy statements to understand how management compensates itself", "Watch whether managers buy or sell their own company's stock", "Beware of executives who blame external factors for every problem", "The best managers underpromise and overdeliver in shareholder letters"]
    },
    {
        id: 9, category: "quality", catLabel: "Business Quality", catColor: "blue",
        title: "Simple Businesses",
        quote: "I try to invest in businesses that are so wonderful that an idiot can run them. Because sooner or later, one will.",
        explanation: "Complexity is the enemy of understanding. Simple businesses with straightforward economics are easier to analyze, predict, and value. They are also more resilient because they do not depend on a genius CEO or perfect execution to survive.",
        example: "Dairy Queen, a Berkshire subsidiary, has a simple model: franchise ice cream shops. The product does not change much, demand is steady, and the franchise model generates fees without requiring heavy capital investment. It is boring, predictable, and profitable.",
        tips: ["If you need a PhD to understand the business, move on", "Simple does not mean unsophisticated -- Coca-Cola's distribution is brilliantly complex but the business model is simple", "Complexity often hides risk that does not appear until it is too late", "Ask: could this business survive a mediocre management team?"]
    },
    {
        id: 10, category: "quality", catLabel: "Business Quality", catColor: "blue",
        title: "Pricing Power",
        quote: "The single most important decision in evaluating a business is pricing power. If you've got the power to raise prices without losing business to a competitor, you've got a very good business.",
        explanation: "Pricing power is the ultimate test of a moat. Companies that can raise prices above inflation without losing customers have a durable competitive advantage. This ability protects margins, generates growing cash flows, and signals genuine value to customers.",
        example: "Apple demonstrates extraordinary pricing power. Despite competitors offering cheaper phones, Apple consistently raises iPhone prices. Customers pay premium prices for the ecosystem, brand, and user experience. This pricing power drives industry-leading profit margins.",
        tips: ["Test pricing power: has the company raised prices faster than inflation without losing share?", "Pricing power often comes from high switching costs or emotional brand attachment", "Commodity businesses have zero pricing power -- avoid them", "Companies with pricing power are the best inflation hedges"]
    },
    {
        id: 11, category: "psychology", catLabel: "Market Psychology", catColor: "purple",
        title: "Mr. Market",
        quote: "The stock market is a device for transferring money from the impatient to the patient.",
        explanation: "Benjamin Graham's allegory, embraced by Buffett: imagine the market as an emotional business partner named Mr. Market who offers to buy or sell shares daily. Some days he is euphoric and offers high prices; other days he is depressed and offers bargains. You are never obligated to trade with him.",
        example: "During COVID-19 in March 2020, Mr. Market priced the S&P 500 down 34% in weeks. Investors who recognized this as emotional panic, not fundamental destruction, bought quality companies at steep discounts. Markets recovered fully within months.",
        tips: ["Mr. Market is there to serve you, not to guide you", "Ignore daily price quotes unless they offer clearly irrational opportunities", "Set price alerts at your target buy prices and ignore noise in between", "The market's short-term voting machine eventually becomes a long-term weighing machine"]
    },
    {
        id: 12, category: "psychology", catLabel: "Market Psychology", catColor: "purple",
        title: "Avoid the Herd",
        quote: "Most people get interested in stocks when everyone else is. The time to get interested is when no one else is. You can't buy what is popular and do well.",
        explanation: "Herd behavior is the single biggest destroyer of investment returns. Investors pile into popular stocks at high prices and sell unpopular ones at low prices -- the exact opposite of profitable behavior. Independence of thought is the investor's greatest edge.",
        example: "In the late 1990s, everyone owned tech stocks. Buffett was mocked for 'not getting it.' When the bubble burst, Nasdaq fell 78%. Buffett's 'boring' holdings in insurance, consumer goods, and utilities steadily compounded while the herd suffered devastating losses.",
        tips: ["If a stock is on every magazine cover, you are probably too late", "Track your decisions: are you buying because of analysis or because others are?", "The most profitable investments often feel uncomfortable at the time of purchase", "Build a process that forces you to act on data, not social proof"]
    },
    {
        id: 13, category: "psychology", catLabel: "Market Psychology", catColor: "purple",
        title: "Patience & Discipline",
        quote: "The stock market is designed to transfer money from the active to the patient. Calling someone who trades actively in the market an investor is like calling someone who repeatedly engages in one-night stands a romantic.",
        explanation: "Buffett compares investing to baseball with no called strikes -- you can let unlimited pitches go by with no penalty. The key is to wait for the fat pitch, the obvious opportunity where risk is minimal and reward is substantial. Most investors swing at everything.",
        example: "From 2013 to 2018, Buffett made almost no major acquisitions, letting Berkshire's cash pile grow to over $100 billion. Critics called him out of touch. Then in 2020 and 2022, he deployed tens of billions into Apple, Occidental Petroleum, and other opportunities at attractive prices.",
        tips: ["Inactivity can be very intelligent behavior -- doing nothing is a valid strategy", "Keep a journal of opportunities you passed on and review them annually", "Set strict buy criteria and never compromise just because you are bored", "Remember: you get paid for being right, not for being active"]
    },
    {
        id: 14, category: "psychology", catLabel: "Market Psychology", catColor: "purple",
        title: "Emotional Control",
        quote: "If you cannot control your emotions, you cannot control your money.",
        explanation: "Investing success is more about temperament than intellect. Fear and greed are the twin enemies. Fear causes panic selling at lows; greed causes euphoric buying at highs. The investor who masters their emotions has an enormous edge over the market.",
        example: "During the 2008 crisis, countless investors with high IQs sold at the bottom because fear overwhelmed their analysis. Buffett, with the same information, stayed calm and invested heavily. The difference was not intelligence but emotional discipline.",
        tips: ["Create an investment policy statement when you are calm and follow it rigidly during turmoil", "Automate investments through dollar-cost averaging to remove emotional timing", "Limit how often you check your portfolio -- daily checking amplifies emotional reactions", "Remember that the best investors are not smarter, they are calmer"]
    },
    {
        id: 15, category: "risk", catLabel: "Risk Management", catColor: "red",
        title: "Avoid Leverage",
        quote: "When you combine ignorance and leverage, you get some pretty interesting results.",
        explanation: "Leverage amplifies both gains and losses, but the asymmetry is deadly. Losses can exceed your entire investment and force you to sell at the worst possible time. Buffett has consistently warned that leverage is the most common cause of permanent capital loss.",
        example: "Long-Term Capital Management (LTCM), run by Nobel laureates, used 25:1 leverage. In 1998, a seemingly small market dislocation wiped out the fund entirely and nearly crashed the global financial system. Brilliance plus leverage equaled catastrophe.",
        tips: ["Never use margin to buy stocks -- it forces selling at the worst times", "If an investment requires leverage to generate attractive returns, the returns are not truly attractive", "Evaluate companies for leverage too: high-debt companies are fragile in downturns", "Sleep-at-night test: if borrowed money keeps you up at night, you have too much"]
    },
    {
        id: 16, category: "risk", catLabel: "Risk Management", catColor: "red",
        title: "Risk vs. Uncertainty",
        quote: "Risk comes from not knowing what you are doing.",
        explanation: "Buffett redefines risk. Academics measure risk as volatility; Buffett measures it as the probability of permanent capital loss. A volatile stock in a business you understand deeply can be low-risk. A stable stock in a business you do not understand is extremely high-risk.",
        example: "When Buffett bought Washington Post in 1973, the stock had fallen 50% and was 'volatile' by academic standards. But Buffett knew the company's assets were worth far more than the market price. Low volatility? No. Low risk? Absolutely.",
        tips: ["Distinguish between price risk (temporary volatility) and value risk (permanent impairment)", "Deep knowledge reduces risk more than diversification does", "If you would not buy the entire business, do not buy a share of it", "Risk is not a number -- it is a judgment call that requires understanding"]
    },
    {
        id: 17, category: "growth", catLabel: "Personal Growth", catColor: "amber",
        title: "Continuous Learning",
        quote: "I just sit in my office and read all day. That's how you build knowledge -- like compound interest.",
        explanation: "Buffett reads 500+ pages per day. He treats knowledge like compound interest: it builds slowly at first, then accelerates exponentially. The more you know, the better you can evaluate opportunities, avoid mistakes, and make confident decisions under uncertainty.",
        example: "Buffett's partner Charlie Munger observed: 'In my whole life, I have known no wise people who did not read all the time -- none, zero.' Buffett's daily routine includes reading 5-6 hours of annual reports, newspapers, and books. This compounding knowledge is his true edge.",
        tips: ["Read annual reports of companies you own and their competitors", "Study business failures as much as successes -- they teach more", "Build mental models from multiple disciplines: psychology, history, math, physics", "Allocate at least 1 hour daily to reading -- treat it as an investment in yourself"]
    },
    {
        id: 18, category: "growth", catLabel: "Personal Growth", catColor: "amber",
        title: "Reputation is Everything",
        quote: "It takes 20 years to build a reputation and five minutes to ruin it. If you think about that, you'll do things differently.",
        explanation: "Buffett places integrity above all else. In investing and business, reputation is a compounding asset. Honest dealing attracts better partners, better deals, and better talent. A single ethical lapse can destroy decades of trust.",
        example: "When Salomon Brothers faced a Treasury bond scandal in 1991, Buffett (as interim chairman) told Congress: 'Lose money for the firm and I will be understanding. Lose a shred of reputation and I will be ruthless.' His swift, honest handling saved the firm.",
        tips: ["In every decision, imagine your actions on the front page of tomorrow's newspaper", "Partner only with people whose integrity you trust completely", "Short-term gains from cutting corners never compensate for long-term reputation damage", "Build a track record of honesty -- it compounds just like money"]
    },
    {
        id: 19, category: "growth", catLabel: "Personal Growth", catColor: "amber",
        title: "Focus Over Diversification",
        quote: "Diversification is protection against ignorance. It makes little sense if you know what you are doing.",
        explanation: "Conventional wisdom says diversify broadly. Buffett disagrees for knowledgeable investors. Concentration in your best ideas amplifies returns when you have genuine insight. Over-diversification dilutes your best ideas with mediocre ones and guarantees average results.",
        example: "In 2016, Buffett began building a massive Apple position, eventually investing over $35 billion. By 2023, Apple alone represented over 45% of Berkshire's equity portfolio. This concentrated bet generated over $100 billion in gains -- more than most diversified portfolios earn in a lifetime.",
        tips: ["Concentrate only when you have deep knowledge and high conviction", "Limit your portfolio to 10-15 positions maximum if you do your own research", "Each new position should be better than your current worst holding", "If you cannot dedicate time to deep research, broad index funds are the honest choice"]
    },
    {
        id: 20, category: "growth", catLabel: "Personal Growth", catColor: "amber",
        title: "Think Independently",
        quote: "You are neither right nor wrong because the crowd disagrees with you. You are right because your data and reasoning are right.",
        explanation: "Independent thinking is the master skill. Consensus opinion is already priced into stocks. Only by thinking differently -- and correctly -- can you achieve above-average returns. This requires courage, rigorous analysis, and comfort with being alone in your view.",
        example: "In 2011, amid European debt crisis fears, Buffett invested $5 billion in Bank of America when most investors were terrified of financial stocks. He had independently analyzed the bank's assets and concluded the fears were overblown. The investment has generated over $20 billion in returns.",
        tips: ["Develop your own thesis before reading anyone else's analysis", "Ask: 'Would I still hold this view if nobody agreed with me?'", "The best investments are often ones where you can articulate why the consensus is wrong", "Value independent thinkers in your circle -- avoid echo chambers"]
    }
];

const quizQuestions = [
    { q: "What does Buffett call the boundary of industries and businesses you truly understand?", options: ["Safety Zone","Circle of Competence","Knowledge Ring","Expertise Boundary"], correct: 1 },
    { q: "According to Buffett, what is Rule #1 of investing?", options: ["Buy low, sell high","Diversify broadly","Never lose money","Follow the trend"], correct: 2 },
    { q: "Buffett's famous quote 'Price is what you pay. Value is what you get.' relates to which concept?", options: ["Market Timing","Intrinsic Value","Technical Analysis","Momentum Investing"], correct: 1 },
    { q: "Which Benjamin Graham concept does Buffett use to describe the market's daily mood swings?", options: ["Dr. Stock","Mr. Market","The Invisible Hand","Captain Economy"], correct: 1 },
    { q: "What term does Buffett use for a company's durable competitive advantage?", options: ["Profit Shield","Business Fortress","Economic Moat","Revenue Wall"], correct: 2 },
    { q: "According to Buffett, what is his favorite holding period?", options: ["5 years","10 years","Until the price doubles","Forever"], correct: 3 },
    { q: "Buffett says you should be greedy when others are _____ and fearful when others are _____.", options: ["fearful; greedy","selling; buying","pessimistic; optimistic","losing; winning"], correct: 0 },
    { q: "How many pages does Buffett reportedly read per day?", options: ["100 pages","200 pages","500 pages","50 pages"], correct: 2 },
    { q: "What does Buffett say diversification is protection against?", options: ["Market crashes","Inflation","Ignorance","Volatility"], correct: 2 },
    { q: "According to Buffett, how long does it take to build a reputation?", options: ["5 years","10 years","20 years","A lifetime"], correct: 2 },
    { q: "Which company did Buffett buy during the 'salad oil scandal' in 1964?", options: ["Coca-Cola","American Express","Goldman Sachs","GEICO"], correct: 1 },
    { q: "Buffett's approach to leverage can be summarized as:", options: ["Use it wisely","Use it aggressively in bull markets","Avoid it","Only use it for real estate"], correct: 2 },
    { q: "Which quality does Buffett consider most important in people he works with?", options: ["Intelligence","Energy","Honesty","Experience"], correct: 2 },
    { q: "Buffett says risk comes from:", options: ["Market volatility","High stock prices","Not knowing what you are doing","Concentrated positions"], correct: 2 },
    { q: "What percentage of Berkshire's equity portfolio did Apple represent at its peak?", options: ["25%","35%","45%","55%"], correct: 2 }
];

// ========== STATE ==========
let currentCategory = 'all';
let quizState = { current: 0, score: 0, questions: [], answered: false };

// ========== RENDER PRINCIPLES ==========
function getCatDot(color) {
    const colors = { emerald:'bg-emerald-400', red:'bg-red-400', blue:'bg-blue-400', purple:'bg-purple-400', amber:'bg-amber-400' };
    return colors[color] || 'bg-gray-400';
}
function getCatBg(color) {
    const colors = { emerald:'bg-emerald-900/20 text-emerald-300 border-emerald-800', red:'bg-red-900/20 text-red-300 border-red-800', blue:'bg-blue-900/20 text-blue-300 border-blue-800', purple:'bg-purple-900/20 text-purple-300 border-purple-800', amber:'bg-amber-900/20 text-amber-300 border-amber-800' };
    return colors[color] || '';
}

function renderCard(p) {
    return `
    <div class="card-hover card-enter gold-border rounded-2xl bg-dark-800 overflow-hidden cursor-pointer" onclick="showDetail(${p.id})">
        <div class="p-6">
            <div class="flex items-center justify-between mb-4">
                <span class="text-xs font-medium px-3 py-1 rounded-full border ${getCatBg(p.catColor)}">${p.catLabel}</span>
                <span class="text-gold-700 text-sm font-display">#${p.id}</span>
            </div>
            <h3 class="text-xl font-display font-bold text-gold-400 mb-3">${p.title}</h3>
            <div class="relative pl-4 border-l-2 border-gold-800 mb-4">
                <p class="text-gray-400 text-sm italic leading-relaxed line-clamp-3">"${p.quote}"</p>
            </div>
            <p class="text-gray-500 text-sm leading-relaxed line-clamp-2 mb-4">${p.explanation}</p>
            <div class="flex items-center text-gold-600 text-sm font-medium group">
                <span class="group-hover:underline">Read more</span>
                <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </div>
        </div>
    </div>`;
}

function filterPrinciples() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const grid = document.getElementById('principlesGrid');
    const noResults = document.getElementById('noResults');
    const resultCount = document.getElementById('resultCount');

    let filtered = principles.filter(p => {
        const catMatch = currentCategory === 'all' || p.category === currentCategory;
        const searchMatch = !search || p.title.toLowerCase().includes(search) || p.quote.toLowerCase().includes(search) || p.explanation.toLowerCase().includes(search) || p.catLabel.toLowerCase().includes(search) || p.example.toLowerCase().includes(search);
        return catMatch && searchMatch;
    });

    if (filtered.length === 0) {
        grid.innerHTML = '';
        noResults.classList.remove('hidden');
        resultCount.textContent = 'No results found';
    } else {
        noResults.classList.add('hidden');
        grid.innerHTML = filtered.map(renderCard).join('');
        resultCount.textContent = filtered.length === 20 ? 'Showing all 20 principles' : `Showing ${filtered.length} of 20 principles`;
    }
}

function setCategory(cat) {
    currentCategory = cat;
    document.querySelectorAll('.cat-badge').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.cat === cat);
    });
    filterPrinciples();
}

function clearSearch() {
    document.getElementById('searchInput').value = '';
    setCategory('all');
}

// ========== DETAIL MODAL ==========
function showDetail(id) {
    const p = principles.find(x => x.id === id);
    if (!p) return;
    const modal = document.getElementById('detailModal');
    const content = document.getElementById('detailContent');

    content.innerHTML = `
        <div class="flex items-center justify-between mb-6">
            <span class="text-xs font-medium px-3 py-1 rounded-full border ${getCatBg(p.catColor)}">${p.catLabel}</span>
            <button onclick="closeDetail()" class="text-gray-500 hover:text-gray-300 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>
        <h2 class="text-3xl font-display font-bold text-gold-400 mb-2">${p.title}</h2>
        <p class="text-gold-700 text-sm font-display mb-6">Principle #${p.id}</p>

        <div class="relative bg-dark-700 rounded-xl p-6 mb-6 border border-gray-700/50">
            <span class="quote-mark absolute -top-2 left-4">&ldquo;</span>
            <p class="text-gray-300 italic leading-relaxed text-lg pl-2">${p.quote}</p>
            <div class="mt-3 text-right text-gold-600 text-sm font-medium">&mdash; Warren Buffett</div>
        </div>

        <div class="space-y-6">
            <div>
                <h4 class="text-sm uppercase tracking-wider text-gold-600 font-semibold mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    Explanation
                </h4>
                <p class="text-gray-300 leading-relaxed">${p.explanation}</p>
            </div>

            <div>
                <h4 class="text-sm uppercase tracking-wider text-gold-600 font-semibold mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                    Real-World Example
                </h4>
                <p class="text-gray-300 leading-relaxed">${p.example}</p>
            </div>

            <div>
                <h4 class="text-sm uppercase tracking-wider text-gold-600 font-semibold mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                    Application Tips
                </h4>
                <ul class="space-y-2">
                    ${p.tips.map(t => `<li class="flex items-start gap-3 text-gray-300"><span class="text-gold-500 mt-1.5 flex-shrink-0"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3"/></svg></span><span class="leading-relaxed">${t}</span></li>`).join('')}
                </ul>
            </div>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-700 flex flex-col sm:flex-row gap-3 items-center justify-between">
            <div class="flex gap-2">
                ${p.id > 1 ? `<button onclick="showDetail(${p.id-1})" class="text-sm text-gray-400 hover:text-gold-400 flex items-center gap-1 transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>Previous</button>` : ''}
                ${p.id < 20 ? `<button onclick="showDetail(${p.id+1})" class="text-sm text-gray-400 hover:text-gold-400 flex items-center gap-1 transition-colors">Next<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>` : ''}
            </div>
            <a href="https://keeprule.com/en/principles" target="_blank" rel="noopener" class="text-sm text-gold-500 hover:text-gold-400 font-medium transition-colors">
                Explore more on KeepRule &rarr;
            </a>
        </div>
    `;

    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeDetail() {
    document.getElementById('detailModal').classList.add('hidden');
    document.body.style.overflow = '';
}

// ========== QUIZ ==========
function shuffleArray(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; }
    return a;
}

function startQuiz() {
    const shuffled = shuffleArray(quizQuestions);
    quizState = { current: 0, score: 0, questions: shuffled.slice(0, 10), answered: false };
    document.getElementById('quizModal').classList.remove('hidden');
    document.getElementById('quizContent').classList.remove('hidden');
    document.getElementById('quizResult').classList.add('hidden');
    document.getElementById('quizNext').classList.add('hidden');
    document.body.style.overflow = 'hidden';
    renderQuestion();
}

function renderQuestion() {
    const q = quizState.questions[quizState.current];
    document.getElementById('quizProgress').textContent = `Question ${quizState.current + 1} of ${quizState.questions.length}`;
    document.getElementById('quizScore').textContent = `Score: ${quizState.score}`;
    document.getElementById('quizProgressBar').style.width = `${((quizState.current + 1) / quizState.questions.length) * 100}%`;
    document.getElementById('quizQuestion').textContent = q.q;
    document.getElementById('quizNext').classList.add('hidden');
    quizState.answered = false;

    const optionsHtml = q.options.map((opt, i) => `
        <button onclick="answerQuiz(${i})" class="quiz-option w-full text-left p-4 rounded-xl border border-gray-600 text-gray-300 hover:text-white" data-idx="${i}">
            <span class="inline-flex items-center justify-center w-7 h-7 rounded-full border border-gray-600 text-sm mr-3 flex-shrink-0">${String.fromCharCode(65+i)}</span>
            ${opt}
        </button>
    `).join('');
    document.getElementById('quizOptions').innerHTML = optionsHtml;
}

function answerQuiz(idx) {
    if (quizState.answered) return;
    quizState.answered = true;
    const q = quizState.questions[quizState.current];
    const buttons = document.querySelectorAll('.quiz-option');

    buttons.forEach((btn, i) => {
        btn.onclick = null;
        if (i === q.correct) btn.classList.add('quiz-correct');
        if (i === idx && idx !== q.correct) btn.classList.add('quiz-wrong');
    });

    if (idx === q.correct) quizState.score++;
    document.getElementById('quizScore').textContent = `Score: ${quizState.score}`;

    if (quizState.current < quizState.questions.length - 1) {
        document.getElementById('quizNext').classList.remove('hidden');
        document.getElementById('quizNext').textContent = 'Next Question';
    } else {
        document.getElementById('quizNext').classList.remove('hidden');
        document.getElementById('quizNext').textContent = 'See Results';
    }
}

function nextQuestion() {
    if (quizState.current < quizState.questions.length - 1) {
        quizState.current++;
        renderQuestion();
    } else {
        showQuizResult();
    }
}

function showQuizResult() {
    document.getElementById('quizContent').classList.add('hidden');
    document.getElementById('quizResult').classList.remove('hidden');
    document.getElementById('quizNext').classList.add('hidden');

    const pct = Math.round((quizState.score / quizState.questions.length) * 100);
    let emoji, title, text;

    if (pct >= 90) { emoji = '&#127942;'; title = 'Outstanding! You think like Buffett.'; text = `You scored ${quizState.score}/${quizState.questions.length} (${pct}%). You have a deep understanding of Buffett's investment philosophy.`; }
    else if (pct >= 70) { emoji = '&#11088;'; title = 'Well done! Solid understanding.'; text = `You scored ${quizState.score}/${quizState.questions.length} (${pct}%). You grasp most of Buffett's key principles.`; }
    else if (pct >= 50) { emoji = '&#128218;'; title = 'Good start! Keep learning.'; text = `You scored ${quizState.score}/${quizState.questions.length} (${pct}%). Review the principles above to strengthen your knowledge.`; }
    else { emoji = '&#128161;'; title = 'Room to grow!'; text = `You scored ${quizState.score}/${quizState.questions.length} (${pct}%). Explore each principle in detail and try again.`; }

    document.getElementById('quizEmoji').innerHTML = emoji;
    document.getElementById('quizResultTitle').textContent = title;
    document.getElementById('quizResultText').textContent = text;
}

function closeQuiz() {
    document.getElementById('quizModal').classList.add('hidden');
    document.body.style.overflow = '';
}

// ========== NAV & MOBILE ==========
function toggleMobileMenu() {
    document.getElementById('mobileMenu').classList.toggle('hidden');
}

window.addEventListener('scroll', () => {
    document.getElementById('navbar').classList.toggle('nav-scrolled', window.scrollY > 20);
});

// Close modals on Escape
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') { closeDetail(); closeQuiz(); }
});

// ========== INIT ==========
filterPrinciples();
</script>

</body>
</html>
